<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <title>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="mb-4">–ê–¥–º—ñ–Ω–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤</h2>

  <!-- –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä (–º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ) -->
  <button class="btn btn-primary mb-4" data-bs-toggle="modal" data-bs-target="#addModal">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</button>

  <div class="row row-cols-1 row-cols-md-3 g-4">
    {% for p in products %}
      <div class="col">
        <div class="card h-100">
          <img src="{{ url_for('static', filename='images/products/' ~ p.image_url.split(',')[0].strip()) }}" class="card-img-top" style="object-fit:cover; height:200px;">
          <div class="card-body">
            <a href="/products/{{p.id}}"><h5 class="card-title">{{ p.name }}</h5></a>
            <p class="card-text">–¶—ñ–Ω–∞: {{ p.price }} –≥—Ä–Ω</p>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è -->
            <form method="POST" action="{{ url_for('main.edit_product', product_id=p.id) }}" enctype="multipart/form-data">
            <input name="name" class="form-control mb-2" value="{{ p.name }}">
            <input name="price" class="form-control mb-2" type="number" step="0.01" value="{{ p.price }}">
            <input name="description" class="form-control mb-2" value="{{ p.description }}">

            <input type="file" name="images" class="form-control mb-2" multiple accept="image/*">

            <select name="category" class="form-select mb-2">
                {% for cat in categories %}
                <option value="{{ cat.id }}" {% if cat.id == p.category_id %}selected{% endif %}>{{ cat.name }}</option>
                {% endfor %}
            </select>

            <select name="manufacturer" class="form-select mb-2">
                {% for m in manufacturers %}
                <option value="{{ m.id }}" {% if m.id == p.manufacturer_id %}selected{% endif %}>{{ m.name }}</option>
                {% endfor %}
            </select>

            <button type="submit" class="btn btn-warning btn-sm">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </form>



            <!-- –í–∏–¥–∞–ª–µ–Ω–Ω—è -->
            <form method="POST" action="{{ url_for('main.delete_product', product_id=p.id) }}" class="mt-2"
                  onsubmit="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ {{ p.name }}?')">
              <button type="submit" class="btn btn-sm btn-danger">‚ùå –í–∏–¥–∞–ª–∏—Ç–∏</button>
            </form>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è -->
<div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" method="POST" action="{{ url_for('main.admin_products') }}" enctype="multipart/form-data">
      <div class="modal-header">
        <h5 class="modal-title" id="addModalLabel">–ù–æ–≤–∏–π —Ç–æ–≤–∞—Ä</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä–∏—Ç–∏"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="action" value="add">
        <div class="mb-3">
          <label class="form-label">–ù–∞–∑–≤–∞</label>
          <input type="text" class="form-control" name="name" required>
        </div>
        <div class="mb-3">
          <label class="form-label">–¶—ñ–Ω–∞</label>
          <input type="number" step="0.01" class="form-control" name="price" required>
        </div>
        <div class="mb-3">
            <label class="form-label">–û–ø–∏—Å</label>
            <textarea class="form-control" name="description" rows="3"></textarea>
           </div>
        <div class="mb-3">
            <label class="form-label">–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è</label>
            <input type="file" class="form-control" name="images" accept="image/*" multiple>
        </div>
        <div class="mb-3">
          <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
          <select class="form-select" name="category">
            {% for cat in categories %}
              <option value="{{ cat.id }}">{{ cat.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">–í–∏—Ä–æ–±–Ω–∏–∫</label>
          <select class="form-select" name="manufacturer">
            {% for m in manufacturers %}
              <option value="{{ m.id }}">{{ m.name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success">–î–æ–¥–∞—Ç–∏</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
